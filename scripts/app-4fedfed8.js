"use strict";angular.module("stank",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngResource","ngRoute","ngMaterial","pouchdb"]).config(["$routeProvider",function(t){t.when("/",{templateUrl:"app/main/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("stank").controller("NavbarCtrl",["$scope",function(t){t.date=new Date}]);var __extends=this.__extends||function(t,e){function s(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);s.prototype=e.prototype,t.prototype=new s},TankGame;!function(t){var e=0,s=0,a=800,i=600,n=function(t){function e(e){t.call(this,e,0,0,"bullet"),this.texture.baseTexture.scaleMode=PIXI.scaleModes.NEAREST,this.anchor.set(.5),this.checkWorldBounds=!0,this.outOfBoundsKill=!0,this.alive=!1,this.exists=!1}return __extends(e,t),e}(Phaser.Sprite),o=function(t){function e(e){t.call(this,e);for(var s=0;100>s;s++){var a=this.create(0,0,"kaboom",[0],!1);a.anchor.setTo(.5,.5),a.animations.add("kaboom")}}return __extends(e,t),e.prototype.play=function(t,e){var s=this.getFirstExists(!1);s&&(s.reset(t,e),s.play("kaboom",30,!1,!0))},e}(Phaser.Group),r=function(t){function e(e,s){t.call(this,e),this.enableBody=!0,this.physicsBodyType=Phaser.Physics.ARCADE;for(var a=0;s>a;a++){var i=new n(e);this.add(i)}}return __extends(e,t),e.prototype.fireToObject=function(t,e,s){var a=this.getFirstDead();a.reset(t,e),a.rotation=this.game.physics.arcade.moveToObject(a,s,500)},e.prototype.fireToPointer=function(t,e,s){var a=this.getFirstExists(!1);a.reset(t,e),a.rotation=this.game.physics.arcade.moveToPointer(a,500,s,0)},e}(Phaser.Group),h=function(t){function e(e,s,a){t.call(this,e,s,a,"enemy","tank1"),this.alive=!0,e.physics.enable(this,Phaser.Physics.ARCADE),this.body.immovable=!1,this.anchor.set(.5),this.checkWorldBounds=!0,this.outOfBoundsKill=!0,this.turret=new Phaser.Sprite(e,0,0,"enemy","turret"),this.turret.anchor.set(.3,.5),this.addChild(this.turret)}return __extends(e,t),e.prototype.go=function(t,e,s,a){this.reset(t,e,this.game.rnd.between(3,10)),this.game.physics.arcade.moveToXY(this,s,a,this.game.rnd.between(50,100))},e.prototype.xDamage=function(t){this.health-=t,this.health<=0&&this.kill()},e}(Phaser.Sprite),l=function(t){function e(e){t.call(this,e,a/2,i-50,"tank","tank1"),this.nextFire=0,this.fireRate=100,this.currentSpeed=0,this.anchor.setTo(.5,.5),this.animations.add("move",["tank1","tank2","tank3","tank4","tank5","tank6"],20,!0),e.physics.enable(this,Phaser.Physics.ARCADE),this.body.drag.set(.2),this.body.maxVelocity.setTo(400,400),this.body.collideWorldBounds=!0,this.turret=new Phaser.Sprite(e,0,0,"tank","turret"),this.turret.anchor.setTo(.3,.5),this.turret.angle=-90,this.addChild(this.turret)}return __extends(e,t),e.prototype.update=function(){this.turret.rotation=this.game.physics.arcade.angleToPointer(this)},e.prototype.fire=function(t){this.game.time.now>this.nextFire&&t.countDead()>0&&(this.nextFire=this.game.time.now+this.fireRate,t.fireToPointer(this.x,this.y,this.game.input.activePointer))},e}(Phaser.Sprite),u=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.create=function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.input.maxPointers=1,this.game.state.start("game")},e}(Phaser.State),m=function(t){function n(){t.apply(this,arguments),this.generateRate=1e3,this.nextGenerateTime=0,this.enemiesKills=0}return __extends(n,t),n.prototype.preload=function(){console.log("PHASER: preload"),this.game.load.atlas("tank","assets/tanks/tanks.png","assets/tanks/tanks.json"),this.game.load.atlas("enemy","assets/tanks/enemy-tanks.png","assets/tanks/tanks.json"),this.game.load.image("logo","assets/tanks/logo.png"),this.game.load.image("bullet","assets/tanks/bullet.png"),this.game.load.image("earth","assets/tanks/scorched_earth.png"),this.game.load.spritesheet("kaboom","assets/tanks/explosion.png",64,64,23)},n.prototype.removeLogo=function(){this.game.input.onDown.remove(this.removeLogo,this),this.logo.kill()},n.prototype.initEnemy=function(){this.enemyGroup=this.game.add.group();for(var t=0;20>t;t++){var s=new h(this.game,e-50,70*(t%5+1));this.enemyGroup.add(s)}},n.prototype.create=function(){console.log("PHASER: create",e,s,a,i),this.game.world.setBounds(e,s,a,i),this.land=this.game.add.tileSprite(e,s,a,i,"earth"),this.land.fixedToCamera=!0,this.playerBullets=new r(this.game,30),this.add.existing(this.playerBullets),this.enemyBullets=new r(this.game,100),this.add.existing(this.enemyBullets),this.player=new l(this.game),this.add.existing(this.player),this.initEnemy(),this.explosions=new o(this.game),this.add.existing(this.explosions),this.logo=this.game.add.sprite(0,200,"logo"),this.logo.fixedToCamera=!0,this.game.input.onDown.add(this.removeLogo,this),this.cursors=this.game.input.keyboard.createCursorKeys()},n.prototype.hitCallback=function(t,e){e.kill(),this.explosions.play(t.x,t.y),t.xDamage(1),0==t.alive&&(this.enemiesKills+=1)},n.prototype.generateEnemy=function(){var t=this.enemyGroup.getFirstDead(),e=this.game.rnd.between(s+50,(s+i)/2);t.go(0,e,a+50,e)},n.prototype.update=function(){this.game.physics.arcade.overlap(this.enemyGroup,this.playerBullets,this.hitCallback,null,this),this.game.physics.arcade.overlap(this.player,this.enemyBullets,this.hitCallback,null,this),this.game.input.activePointer.isDown&&this.player.fire(this.playerBullets),this.game.time.now>this.nextGenerateTime&&this.enemyGroup.countDead()>0&&(this.generateEnemy(),this.nextGenerateTime=this.game.time.now+this.generateRate)},n.prototype.render=function(){this.game.debug.text("Kills: "+this.enemiesKills,32,32)},n}(Phaser.State),d=function(t){function e(e){t.call(this,a,i,Phaser.AUTO,e),this.state.add("boot",new u),this.state.add("game",new m),this.state.start("boot",!0,!0)}return __extends(e,t),e}(Phaser.Game);t.Game=d}(TankGame||(TankGame={})),angular.module("stank").factory("TankGame",function(){return TankGame.Game}),angular.module("stank").controller("MainCtrl",["$scope","TankGame",function(t,e){t.game=new e("game-view")}]),angular.module("stank").run(["$templateCache",function(t){t.put("app/main/main.html",'<div id="game-view" style="height: 100vh;overflow: hidden"></div>'),t.put("app/components/navbar/navbar.html",'<md-toolbar layout="row" layout-align="center center" ng-controller="NavbarCtrl"><md-button>Tank</md-button><section flex="" layout="row" layout-align="left center"><md-button href="#" class="md-raised">Home</md-button><md-button href="#" class="md-raised">About</md-button><md-button href="#" class="md-raised">Contact</md-button></section><md-button href="#">Current date: {{ date | date:\'yyyy-MM-dd\' }}</md-button></md-toolbar>')}]);